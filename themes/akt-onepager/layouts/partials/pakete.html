<section class="section" id="pakete">
  <div class="container">
    <h2 class="center">Werden Sie Teil der Crew</h2>
    <p class="center lead" style="margin-bottom:2rem;">Wir bieten vier verschiedene Crew-R채nge an, die sich in Preis und Umfang unterscheiden. W채hlen Sie Ihr passendes Paket und werden Sie Teil der Crew des AKT 2026 in Bremen.</p>
   
    {{/* Identify featured tier: prefer data flag .featured (bool or map.enabled), fallback to name == "Kapit채n" */}}
    {{ $tiers := .Site.Data.packages.tiers }}
    {{ $featuredList := where $tiers "featured" true }}
    {{ if not (gt (len $featuredList) 0) }}
      {{ $featuredList = where $tiers "name" "Kapit채n" }}
    {{ end }}

    {{/* Use flags/strings instead of nil to avoid pipeline errors */}}
    {{ $hasFeatured := gt (len $featuredList) 0 }}
    {{ $featuredName := "" }}
    {{ if $hasFeatured }}
      {{ $featured := index $featuredList 0 }}
      {{ $featuredName = $featured.name }}
    {{ end }}

    {{ $rest := where $tiers "name" "ne" $featuredName }}

    <div class="tiers pyramid-grid">
      {{ if $hasFeatured }}
        {{ $featured := index $featuredList 0 }}
        {{ $ac := $featured.accent }}
        <article class="card tier featured pyramid-top {{ if (and (ne (printf "%T" $ac) "bool") (ne $ac "")) }}{{ $ac }}{{ else }}{{ if $ac }}accent{{ end }}{{ end }}">
          {{ with $featured.ribbon }}<div class="ribbon">{{ . }}</div>{{ else }}<div class="ribbon">Empfehlung</div>{{ end }}
          <h3 style="font-size:1.8rem; margin-top:0;">{{ $featured.name }}</h3>
          <ul class="features" style="margin:0; padding-left:1.1rem; flex:1 1 auto;">
            {{ range $featured.features }}
              <li class="{{ .class }}">{{ .text }}</li>
            {{ end }}
          </ul>
          {{ with $featured.price }}<p class="price" style="margin:.75rem 0 0 0;">{{ . }}</p>{{ end }}
          <a class="btn primary full" href="#kontakt">Jetzt anfragen</a>
        </article>
      {{ end }}

      {{ range $index, $tier := $rest }}
        {{ $ac := $tier.accent }}
        <article class="card tier pyramid-base {{ if (and (ne (printf "%T" $ac) "bool") (ne $ac "")) }}{{ $ac }}{{ else }}{{ if $ac }}accent{{ end }}{{ end }}">
          {{ with $tier.ribbon }}<div class="ribbon">{{ . }}</div>{{ end }}
          <h3>{{ $tier.name }}</h3>
          <ul class="features" style="margin:0; padding-left:1.1rem; flex:1 1 auto;">
            {{ range $tier.features }}
              <li class="{{ .class }}">{{ .text }}</li>
            {{ end }}
          </ul>
          {{ with $tier.price }}<p class="price" style="margin:.75rem 0 0 0;">{{ . }}</p>{{ end }}
          <a class="btn primary full" href="#kontakt">Jetzt anfragen</a>
        </article>
      {{ end }}
    </div>
  </div>

  <div class="container" style="margin-top:5rem;">
    <h2 class="center">Zubuchbare Pakete</h2>
    <p class="center lead" style="margin-bottom:2rem;">Add-ons, die zu einem Sponsoring-Paket hinzubuchbar sind.</p>

    {{ $addons := .Site.Data.addons.addons }}
    {{ $compact := where $addons "compact" true }}
    {{ $regular := where $addons "compact" "ne" true }}

    {{ if gt (len $compact) 0 }}
    <div class="addons-compact-row">
      {{ range $compact }}
      <article class="addon-chip card addon-card addon-compact">
        <div class="addon-chip-body">
          <div>
            <h3>{{ .name }}</h3>
            {{ with .applies }}<span class="chip-applies">{{ . }}</span>{{ end }}
          </div>
          <div class="chip-meta">
            {{ if .limited }}<span class="chip-limited">Limitiert</span>{{ end }}
            {{ with .price }}<span class="chip-price">{{ . }}</span>{{ end }}
          </div>
        </div>
        <a class="btn primary chip-btn" href="#kontakt">Jetzt anfragen</a>
      </article>
      {{ end }}
    </div>
    {{ end }}

    <div class="addons-grid">
      {{ range $regular }}
      <article class="card tier addon addon-card{{ if .compact }} addon-compact{{ end }}">
        {{ if .limited }}
          <span class="badge badge-warn" style="position:absolute; top:12px; right:12px;">Limitiert</span>
        {{ end }}

        <header style="margin-bottom:.4rem;">
          <h3 style="margin:0; line-height:1.2;">{{ .name }}</h3>
        </header>

        {{ with .applies }}
        <div style="margin:0 0 .75rem 0;">
          <span style="display:inline-block; font-size:.85rem; padding:.2rem .5rem; border:1px solid var(--border); border-radius:999px; color:var(--muted);">{{ . }}</span>
        </div>
        {{ end }}

        {{ with .price }}<p class="addon-price">{{ . }}</p>{{ end }}

        <div class="addon-content" style="flex:1 1 auto; width:100%;">
          {{ $hasInfo := .info }}
          {{ $hasExamples := .examples }}
          {{ if or $hasInfo $hasExamples }}
            <ul class="addon-details">
              {{ with .info }}
                {{ $type := printf "%T" . }}
                {{ if eq $type "[]interface {}" }}
                  {{ range . }}<li>{{ . }}</li>{{ end }}
                {{ else }}
                  <li>{{ . }}</li>
                {{ end }}
              {{ end }}
              {{ with .examples }}
                {{ range . }}<li>{{ . }}</li>{{ end }}
              {{ end }}
            </ul>
          {{ end }}
        </div>

        {{ $note := or .note $.Site.Data.addons.note }}
        {{ with $note }}
        <p class="mini addon-note">{{ . }}</p>
        {{ end }}

        <div style="margin-top: auto;">
          <a class="btn primary full" href="#kontakt">Jetzt anfragen</a>
        </div>
      </article>
      {{ end }}
    </div>
    <p class="center" style="margin-top: 4rem;">Individuelle Pakete und Preise auf Anfrage. <a href="#kontakt">Kontakt aufnehmen</a>.</p>
  </div>
</section>
