<section class="section" id="pakete">
  <div class="container">
    <h2 class="center">Werden Sie Teil der Crew</h2>
    <p class="center lead" style="margin-bottom:2rem;">Wir bieten vier verschiedene Crew-R채nge an, die sich in Preis und Umfang unterscheiden. W채hlen Sie Ihr passendes Paket und werden Sie Teil der Crew des AKT 2026 in Bremen.</p>
   
    {{/* Identify featured tier: prefer data flag .featured (bool or map.enabled), fallback to name == "Kapit채n" */}}
    {{ $tiers := .Site.Data.packages.tiers }}
    {{ $featuredList := where $tiers "featured" true }}
    {{ if not (gt (len $featuredList) 0) }}
      {{ $featuredList = where $tiers "name" "Kapit채n" }}
    {{ end }}

    {{/* Use flags/strings instead of nil to avoid pipeline errors */}}
    {{ $hasFeatured := gt (len $featuredList) 0 }}
    {{ $featuredName := "" }}
    {{ if $hasFeatured }}
      {{ $featured := index $featuredList 0 }}
      {{ $featuredName = $featured.name }}
    {{ end }}

    {{ $rest := where $tiers "name" "ne" $featuredName }}

    {{ if $hasFeatured }}
    {{ $featured := index $featuredList 0 }}
    <div class="tiers featured-tier" style="display:flex; justify-content:center; margin-bottom:2rem;">
      {{ $ac := $featured.accent }}
      <article class="card tier featured {{ if (and (ne (printf "%T" $ac) "bool") (ne $ac "")) }}{{ $ac }}{{ else }}{{ if $ac }}accent{{ end }}{{ end }}" style="max-width: 420px; width:100%;"> 
        {{ with $featured.ribbon }}<div class="ribbon">{{ . }}</div>{{ else }}<div class="ribbon">Empfehlung</div>{{ end }}
        <h3 style="font-size:1.8rem; margin-top:0;">{{ $featured.name }}</h3>
        <ul class="features">
          {{ range $featured.features }}
            <li class="{{ .class }}">{{ .text }}</li>
          {{ end }}
        </ul>
        <a class="btn primary full" href="#kontakt">Jetzt anfragen</a>
      </article>
    </div>
    {{ end }}

    <div class="tiers" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; width: 100%; justify-content: center;">
      {{ range $index, $tier := $rest }}
      {{ $ac := $tier.accent }}
      <article class="card tier {{ if (and (ne (printf "%T" $ac) "bool") (ne $ac "")) }}{{ $ac }}{{ else }}{{ if $ac }}accent{{ end }}{{ end }}">
        {{ with $tier.ribbon }}<div class="ribbon">{{ . }}</div>{{ end }}
        <h3>{{ $tier.name }}</h3>
        <ul class="features">
          {{ range $tier.features }}
            <li class="{{ .class }}">{{ .text }}</li>
          {{ end }}
        </ul>
        <a class="btn primary full" href="#kontakt">Jetzt anfragen</a>
      </article>
      {{ end }}
    </div>
  </div>

  <div class="container" style="margin-top:5rem;">
    <h2 class="center">Zubuchbare Pakete</h2>
    <p class="center lead" style="margin-bottom:2rem;">Add-ons, die zu einem Sponsoring-Paket hinzubuchbar sind.</p>

    <div class="tiers" style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; align-items: stretch;">
      {{ range .Site.Data.addons.addons }}
      <article class="card tier addon" style="position:relative; display:flex; flex-direction:column; padding:1.25rem; min-height: 260px;">
        {{ if .limited }}
          <span class="badge badge-warn" style="position:absolute; top:12px; right:12px;">Limitiert</span>
        {{ end }}

        <header style="margin-bottom:.4rem;">
          <h3 style="margin:0; line-height:1.2;">{{ .name }}</h3>
        </header>

        {{ with .applies }}
        <div style="margin:0 0 .75rem 0;">
          <span style="display:inline-block; font-size:.85rem; padding:.2rem .5rem; border:1px solid var(--border); border-radius:999px; color:var(--muted);">{{ . }}</span>
        </div>
        {{ end }}

        {{ with .examples }}
        <ul style="margin:0; padding-left:1.1rem; flex:1 1 auto;">
          {{ range . }}<li style="margin:.25rem 0;">{{ . }}</li>{{ end }}
        </ul>
        {{ end }}

        {{ with $.Site.Data.addons.note }}
        <p class="mini" style="margin:.75rem 0 0 0; color:var(--muted);">{{ . }}</p>
        {{ end }}

        <div style="margin-top: auto;">
          <a class="btn primary full" href="#kontakt">Jetzt anfragen</a>
        </div>
      </article>
      {{ end }}
    </div>
    <p class="center" style="margin-top: 4rem;">Individuelle Pakete und Preise auf Anfrage. <a href="#kontakt">Kontakt aufnehmen</a>.</p>
  </div>
</section>
